function delete_record(e,t){var n,i,a=$("meta[name=csrf-token]").attr("content");if("profile"==t||"training-user"==t){n=$(e).data("url");var o=$(e).data("type");i="profile"==t?$(e).closest("li"):$(e).closest("tr")}else{var r=$(e).data("id"),o=t;i=$("."+t+"-"+r),n="/"+t+"/"+r}i.addClass("red accent-1"),confirm("Are you sure you wish to delete this "+o+"?")?$.ajax({url:root+n,type:"post",data:{_method:"delete",_token:a},success:function(e){i.remove(),Materialize.toast("The selected "+o+" was deleted successfully.",4e3)}}):i.removeClass("red accent-1")}function showNewForm(){$("#new-form").collapse("show")}function hiddenField(e,t,n,i){var a=$(i+" input[type=hidden]#"+e);0==a.length?$("<input>").attr({type:"hidden",id:e,name:t,value:n}).appendTo(i):a.val(n)}function trainingAssignmentFilters(e){$("#assignment_buttons .btn").removeClass("active");var t=$("#new-training #training_due_date"),n=$("#new-training #training_location"),i=$("#new-training #training_start"),a=$("#new-training #training_end"),o=$("#new-training #user_field"),r=$("#new-training #group_field");switch(e){case"due_date":t.show(),n.hide(),i.hide(),a.hide(),o.show(),r.show();break;case"meeting":t.hide(),n.show(),i.show(),a.show(),o.show(),r.show();break;default:t.hide(),n.hide(),i.hide(),a.hide(),o.hide(),r.hide()}}function get_type(){var e=$(".btn.filter.active").attr("id");return"all"!=e&&"logs"!=e||(e="general"),e}function reset_form(){show_hide_note_fields(get_type()),$("#new-form #type").prop("disabled",!1).val(get_type()).selectpicker("refresh"),$("input[type=hidden]#type").remove(),$("input[type=submit]").val("Create"),$(".assign_user #id").remove(),$(".group-form").attr("action",root+"/group"),$("#name").removeProp("readonly"),$("#training_field select").prop("disabled",!1).val("").selectpicker("refresh"),$("#user_field select").val("").selectpicker("refresh"),$("#new-form #method").remove(),$("#new-form form").hasClass("assign_users")&&($(".assign_user #method").remove(),$(".assign_user #id").remove()),$("#new-form form").hasClass("group-form")&&$(".group-form").attr("action",root+"/group"),$("#new-form form").hasClass("note-form")&&$(".note-form").attr("action",root+"/note")}function formatToday(){var e=new Date,t=""+(e.getMonth()+1),n=""+e.getDate(),i=e.getFullYear();return t.length<2&&(t="0"+t),n.length<2&&(n="0"+n),[i,t,n].join("-")}$(document).ready(function(){$("#_new_user_groups_field").change(function(){var e=$(this).val();$(".closed-area").hide(),$.each(e,function(e,t){$("#access-"+t).show()})})}),$(document).ready(function(){$(".delete-record").click(function(){delete_record(this,"profile")}),$(".delete-group").click(function(){delete_record(this,"group")}),$(".delete-user").click(function(){delete_record(this,"user")}),$(".delete-training").click(function(){delete_record(this,"training")}),$(".delete-training-user").click(function(){delete_record(this,"training-user")}),$(".delete-duty").click(function(){delete_record(this,"duty")}),$(".delete-news").click(function(){delete_record(this,"news")}),$(".chip .close").click(function(){delete_record(this,"attachment")})}),$(function(){var e=[],t=[],n="",i="";$(".duty-swap").click(function(){$(this).removeClass("btn-default").addClass("btn-success");var a=e.length;if(e[a]=$(this).data("id"),t[a]=$(this).data("date"),n=$(this).data("duty"),i=$(this).data("type"),1==a&&e[0]==e[1]&&(e.pop(),data.pop()),1==a){var o=$("<form>",{method:"POST",action:root+"/duty-swap",target:"_top"}).append($("<input>",{name:"_token",type:"hidden",value:$("meta[name=csrf-token]").attr("content")})).append($("<input>",{name:"id",type:"hidden",value:e})).append($("<input>",{name:"date",type:"hidden",value:t})).append($("<input>",{name:"duty",type:"hidden",value:n})).append($("<input>",{name:"type",type:"hidden",value:i}));o.appendTo("body").submit()}})}),$(function(){$(".edit_training").click(function(){showNewForm();var e=$(this).closest("tr"),t=e.find("a").attr("href"),n=t.split("/");$("#user_field select").val(n[n.length-1]).selectpicker("refresh").focus(),$("input#due_date").val(e.children(".training_due_date").text()),$("input#completed_date").val(e.children(".training_completed_date").text()),hiddenField("id","id",$(this).data("id"),".assign_user"),hiddenField("method","_method","PUT",".assign_user"),$("input[type=submit]").val("Update")}),$(".edit_group").click(function(){showNewForm();var e=$(this).closest("tr"),t=new Array,n=new Array;e.children(".training-list").children("a").each(function(){t.push($(this).data("id"))}),e.children(".users-list").children("a").each(function(){n.push($(this).data("id"))}),$("#training_field select").val(t).selectpicker("refresh").focus(),$("#user_field select").val(n).selectpicker("refresh");var i=e.children(".group-name").text();$("#name").val(i),"Lab_"==i.substr(0,4)&&$("#name").prop("readonly","readonly"),hiddenField("method","_method","PUT",".group-form"),$(".group-form").attr("action",root+"/group/"+$(this).data("id")),$("input[type=submit]").val("Update")}),$(".edit-note").click(function(){showNewForm(),update_self&&($("#training_id").prop("disabled",!0).selectpicker("refresh"),$("input[type=reset]").hide(),$("#note_textarea > label").text("Optional note:"));var e=$(this).closest(".note, .alert"),t=e.data("id");show_hide_note_fields(t),$("#type").prop("disabled",!0).val(t).selectpicker("refresh").focus(),hiddenField("type","type",t,".note-form"),$("#private").prop("checked",e.data("private")),$("#note").val(e.find(".note-content").text()),$("#due_date").val(e.find(".due-date").text()),$("#completed_date").val(e.find(".completed-date").text()),$("#training_id").val(e.find(".training-link").data("id")).selectpicker("refresh"),$("#alert").prop("checked",e.hasClass("alert")),hiddenField("method","_method","PUT",".note-form"),$(".note-form").attr("action",root+"/note/"+$(this).data("id")),$("input[type=submit]").val("Update")})}),$(function(){$("#email").keypress(function(){var e=$("#email").val(),t=e.split("@");$("#username").val(t[0])})}),$(document).ready(function(e){var t=new Bloodhound({prefetch:{url:root+"/search",filter:function(t){return e.map(t.data.user,function(e){return{name:e.last_name+", "+e.first_name,id:e.id,employeeNumber:e.emp_num}})}},datumTokenizer:function(e){var t=Bloodhound.tokenizers.whitespace(e.name),n=Bloodhound.tokenizers.whitespace(e.employeeNumber);return t.concat(n)},queryTokenizer:Bloodhound.tokenizers.whitespace});t.initialize(),e(".search-input").typeahead({minLength:2,highlight:!0},{source:t.ttAdapter(),display:"name",name:"usersList",templates:{empty:['<div class="list-group search-results-dropdown"><div class="list-group-item" style="color:black">Nothing found.</div></div>'],suggestion:function(e){return'<div><a href="'+root+"/user/"+e.id+'" class="list-group-item">'+e.name+" <small>("+e.employeeNumber+")</small></a></div>"}}})}),$(document).ready(function(){$(".button-collapse").sideNav(),$(".tooltipped").tooltip(),$(".modal-trigger").leanModal(),$(".dropdown-button").dropdown({hover:!0,belowOrigin:!0}),$(".datepicker").pickadate({onSet:function(e){"select"in e&&this.close()},format:"yyyy-mm-dd",container:"body",selectYears:!0,selectMonths:!0}),$(".data-table").DataTable({paging:!1}),$("div.alert").not(".note").delay(8e3).slideUp(500),$.ajaxSetup({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")}}),$("#js-upload").change(function(){$("#attachments-form").submit()}),$("select").material_select()}),$(function(){trainingAssignmentFilters("none"),$("#ab-due-date").click(function(){trainingAssignmentFilters("due_date")}),$("#ab-meeting").click(function(){trainingAssignmentFilters("meeting")}),$("#ab-none").click(function(){trainingAssignmentFilters("none")}),$("#training-reset").click(function(){trainingAssignmentFilters("none")})}),$(function(){$("input[type=reset]").click(function(){reset_form()}),$("#show-form").click(function(){reset_form()})}),$(function(){$(".completed-today").click(function(){var e=formatToday(),t=$(this).data("id"),n=$(this).data("user"),i=$("meta[name=csrf-token]").attr("content");$(this).closest("tr").children(".training_completed_date").text(e),$(this).hide(),$(this).closest("td").children("a").hide(),$.ajax({url:root+"/user/"+n+"/training/"+t,type:"post",data:{_method:"put",_token:i,completed_date:e},success:function(e){}})})}),$(function(){$("#group_field select").on("change",function(e){var t=$("meta[name=csrf-token]").attr("content"),n=$(this).val();$.ajax({url:root+"/group-user-id",type:"post",data:{_method:"post",_token:t,groups:n},success:function(e){"string"==typeof e?$("select.User-select").val(""):"object"==typeof e&&$("select.User-select").val(e),$("select").material_select()}})})}),$(function(){function e(e){$("#groups").empty().toggle(),$.each(e,function(t){$("<li/>").text(e[t]).appendTo("#groups")}),$("#group_select").toggleClass("hide")}$("#edit_groups").click(function(){$("#groups").toggle(),$("#group_select").toggleClass("hide")}),$("#group_select .submit").click(function(){var t=new Array;$("#group_select").find("select").each(function(){t=$(this).val()});var n=window.location.pathname;n=n.split("/"),id=n[n.length-1],$.ajax({url:root+"/user/"+id,type:"post",data:{_method:"put",_token:$('meta[name="csrf-token"]').attr("content"),groups:t},success:function(t){e(t)},error:function(){e(new Array("None"))}})})});